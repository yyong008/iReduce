# Conditional Caching

协商缓存是浏览器和服务器之间的一种机制，用于确定资源是否需要重新下载。它通过比较客户端（通常是浏览器）的缓存副本与服务器上的原始资源来确定资源是否已经过期。如果资源没有发生变化，则可以避免重新下载，直接使用客户端已有的缓存副本。

### 一般原理：

1. **客户端发起请求**：浏览器请求资源时，会检查是否存在该资源的缓存副本，如果有，则向服务器发送请求。
2. **服务器响应**：服务器收到请求后，会检查资源是否具有可缓存性。如果资源可缓存且未过期，服务器会返回状态码 304（Not Modified）以及一些与资源相关的元数据（例如 ETag、Last-Modified 等）。
3. **客户端根据响应进行处理**：如果收到 304 状态码，表示资源未发生变化，浏览器会使用本地缓存副本。否则，服务器返回最新的资源内容。

### 常见的协商缓存机制：

1. **Last-Modified / If-Modified-Since**：服务器在响应头中返回资源的最后修改时间（Last-Modified），客户端在后续请求中通过 If-Modified-Since 头将该时间发送给服务器。服务器根据该时间判断资源是否已修改。
2. **ETag / If-None-Match**：服务器在响应头中返回资源的唯一标识（ETag），客户端在后续请求中通过 If-None-Match 头将该标识发送给服务器。服务器根据比较 ETag 判断资源是否已修改。

### 优势和注意事项：

- **减少网络传输**: 协商缓存减少了不必要的网络传输，提高了性能和加载速度。
- **注意兼容性**: 有些代理服务器可能不正确地处理协商缓存，导致缓存失效或性能问题。
- **精细化控制**: ETag 比 Last-Modified 更精确，因为它可以基于内容生成而不仅仅是最后修改时间。
